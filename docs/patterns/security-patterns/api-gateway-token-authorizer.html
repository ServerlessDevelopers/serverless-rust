<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-patterns/security-patterns/api-gateway-token-authorizer" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">API Gateway Token Authorizer | Serverless Rust</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://serverless-rust.com/docs/patterns/security-patterns/api-gateway-token-authorizer"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="API Gateway Token Authorizer | Serverless Rust"><meta data-rh="true" name="description" content="Lambda function for authorizer an API Gateway request"><meta data-rh="true" property="og:description" content="Lambda function for authorizer an API Gateway request"><meta data-rh="true" name="keywords" content="rust,lambda,api gateway,security"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://serverless-rust.com/docs/patterns/security-patterns/api-gateway-token-authorizer"><link data-rh="true" rel="alternate" href="https://serverless-rust.com/docs/patterns/security-patterns/api-gateway-token-authorizer" hreflang="en"><link data-rh="true" rel="alternate" href="https://serverless-rust.com/docs/patterns/security-patterns/api-gateway-token-authorizer" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JWKWKGFW71"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JWKWKGFW71",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.fda55b57.css">
<script src="/assets/js/runtime~main.d59cbaa0.js" defer="defer"></script>
<script src="/assets/js/main.599914a0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Serverless Rust</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/why-rust">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/serverlessdevelopers/serverless-rust/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/why-rust">Why Rust?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/fundamentals">Fundamentals</a><button aria-label="Expand sidebar category &#x27;Fundamentals&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/common-patterns">Common Patterns</a><button aria-label="Collapse sidebar category &#x27;Common Patterns&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/api">API</a><button aria-label="Expand sidebar category &#x27;API&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/cicd-1">CI/CD</a><button aria-label="Expand sidebar category &#x27;CI/CD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/containers">Containers</a><button aria-label="Expand sidebar category &#x27;Containers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/database">Database</a><button aria-label="Expand sidebar category &#x27;Database&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/messaging">Messaging</a><button aria-label="Expand sidebar category &#x27;Messaging&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/security">Security</a><button aria-label="Collapse sidebar category &#x27;Security&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/patterns/security-patterns/api-gateway-token-authorizer">API Gateway Token Authorizer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/patterns/security-patterns/congito-token-customization">Cognito Token Customization</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/common-patterns"><span itemprop="name">Common Patterns</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/security"><span itemprop="name">Security</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">API Gateway Token Authorizer</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>API Gateway Token Authorizer</h1></header><style>[data-ch-theme="dark-plus"] {  --ch-t-colorScheme: dark;--ch-t-foreground: #D4D4D4;--ch-t-background: #1E1E1E;--ch-t-lighter-inlineBackground: #1e1e1ee6;--ch-t-editor-background: #1E1E1E;--ch-t-editor-foreground: #D4D4D4;--ch-t-editor-rangeHighlightBackground: #ffffff0b;--ch-t-editor-infoForeground: #3794FF;--ch-t-editor-selectionBackground: #264F78;--ch-t-focusBorder: #007FD4;--ch-t-tab-activeBackground: #1E1E1E;--ch-t-tab-activeForeground: #ffffff;--ch-t-tab-inactiveBackground: #2D2D2D;--ch-t-tab-inactiveForeground: #ffffff80;--ch-t-tab-border: #252526;--ch-t-tab-activeBorder: #1E1E1E;--ch-t-editorGroup-border: #444444;--ch-t-editorGroupHeader-tabsBackground: #252526;--ch-t-editorLineNumber-foreground: #858585;--ch-t-input-background: #3C3C3C;--ch-t-input-foreground: #D4D4D4;--ch-t-icon-foreground: #C5C5C5;--ch-t-sideBar-background: #252526;--ch-t-sideBar-foreground: #D4D4D4;--ch-t-sideBar-border: #252526;--ch-t-list-activeSelectionBackground: #094771;--ch-t-list-activeSelectionForeground: #fffffe;--ch-t-list-hoverBackground: #2A2D2E; }</style>
<p>Applications require security.  There isn&#x27;t a debate here, they just do.  And serverless applications are no different.  One of the knocks against serverless is that it isn&#x27;t secure.  That&#x27;s 100% a false narrative.  However, serverless paired with Infrastructure as Code (IaC) can make it easy sometimes to ship things that do lack the proper controls.</p>
<p>When building API-based solutions, AWS&#x27; API Gateway is a great way to shape traffic, mold payloads and integrate directly into other AWS services.  One thing that&#x27;s not highlighted enough is custom API Authorizers powered by Lambda.  This article will discuss a template that shows how to build an API Gateway custom authorizer with Rust, because who doesn&#x27;t want to prioritize safety and speed at the top an authorizer&#x27;s list of requirements?</p>
<h2 id="how-it-works">How it Works</h2>
<p>Each endpoint in API gateway gives the builder an option to require authorization on top of the request by way of Cognito, IAM or custom Lambda.  If you are using Cognito, you could make the argument that using the Cognito authorizer is the way to go.  But you are limited to the default integration.  By chooosing a custom Lambda authorizer, you can override the context that is supplied to proxy requests thus grabbing information that reduces further burden on downstream systems.</p>
<p>This article assumes that we are working with a Cognito generated JWT that could have been customized like in the pattern <a href="/docs/patterns/security-patterns/congito-token-customization">shown here</a>.</p>
<p>Using this pattern will save you CPU cycles, I/O requests and will give you a layer of security on top of your API Endpoints.</p>
<h2 id="project-structure">Project Structure</h2>
<p>This starter project is organized around a single Lambda handler with a shared library crate can be used for the JSON Web Token (JWT) claims and models.</p>
<div class="ch-codeblock not-prose" data-ch-theme="dark-plus"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>source/</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>   api-gateway-authorizer/</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>   shared/</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>Cargo.toml</span></div></div><br></code></div></div>
<p>The template that this article will be working from can be found under the <a href="https://github.com/serverlessdevelopers/serverless-rust/tree/main/templates/patterns/security-patterns/api-gateway-authorizer">./templates</a> directory in the GitHub repo. You can use template to get started building with API Gateway Authorizers and Lambda.</p>
<h2 id="lambda-code">Lambda Code</h2>
<p>This Lambda code is build around two points.</p>
<ol>
<li>The shared library that holds the models and where you can customize your business logic</li>
<li>The main func and handler code for the Lambda</li>
</ol>
<p>Let&#x27;s start off by talking about the shared library.</p>
<h3 id="shared-code">Shared Code</h3>
<p>The shared code for this sample is not complex, but it&#x27;s important to not that when working with JWT&#x27;s, the deserialization and data types of the fields can be important.  Sure, there are ways around bad fields or mis-matched types, but if you are creating the JWT, you should have a really good understanding of what the payloads should look like.</p>
<section class="ch-section"><p>The main two structs which will serves as models in this project are defined below.  The first struct called <span class="ch-section-link" data-active="false"><code>Claim</code></span> includes macros for Serializing, Deserializing and Debug.  You&#x27;ll notice that many of the fields seem standard in most Access tokens, because this example is working with an Access token.</p><div class="ch-codeblock not-prose" data-ch-theme="dark-plus"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>#[derive(Serialize, Deserialize, Debug)]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>pub struct Claim {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    pub auth_time: i64,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    client_id: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    event_id: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    exp: i64,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    iat: i64,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    iss: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    jti: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    #[serde(rename = &quot;locationId&quot;)]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    location_id: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    origin_jti: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    scope: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    sub: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    token_use: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    username: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    roles: String</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>#[derive(Serialize, Deserialize, Debug)]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>struct PrivateClaim {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    user_name: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    location_id: String,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    roles: String</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div><p>This second struct is defining the <span class="ch-section-link" data-active="false"><code>PrivateClaim</code></span> that we want to pass along in the context object of the authorization payload which I&#x27;ll highlight in the handler code.</p><p>What will show up as we work further through this sample is that there are 3 fields that will are important be passed along and they are defined in the PrivateClaim struct.</p></section>
<section class="ch-section"><p>The next piece that is in this library includes a custom error enumeration.  As with other samples is this website, custom errors in Rust are very powerful and help to be specific when defining interfaces.</p><div class="ch-codeblock not-prose" data-ch-theme="dark-plus"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>#[derive(Debug, Error)]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>pub enum AuthorizerError {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    #[error(&quot;Something is wrong with the Cognito portion of the JWT&quot;)]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    JWTCognitoError,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    #[error(&quot;The JSON was bad.  The serde failed.&quot;)]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    InvalidSerde,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    #[error(&quot;The JWT is invalid&quot;)]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    InvalidJWT,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>impl From&lt;jsonwebtokens::error::Error&gt; for AuthorizerError {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    fn from(_: jsonwebtokens::error::Error) -&gt; Self {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        AuthorizerError::InvalidJWT</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>impl From&lt;serde_json::Error&gt; for AuthorizerError {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    fn from(_: serde_json::Error) -&gt; Self {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        AuthorizerError::InvalidSerde</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>impl From&lt;jsonwebtokens_cognito::Error&gt; for AuthorizerError {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    fn from(_: jsonwebtokens_cognito::Error) -&gt; Self {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        AuthorizerError::JWTCognitoError</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></section>
<section class="ch-section"><p>The last piece of this shared library is to look into the <span class="ch-section-link" data-active="false"><code>dump_claims</code></span> function.  The purpose is this it to take the value from the JWT claims and fill out the PrivateClaim struct as defined above.  This PrivateClaim is then used as context in subsequent API requests.</p><div class="ch-codeblock not-prose" data-ch-theme="dark-plus"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>pub fn dump_claims(value: &amp;serde_json::Value) -&gt; Result&lt;serde_json::Value, serde_json::Error&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let claim: Result&lt;Claim, serde_json::Error&gt; = serde_json::from_value(value.clone());</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    match claim {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Ok(c) =&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            let pc = PrivateClaim {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                user_name: c.username,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                location_id: c.location_id,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                roles: c.roles</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            };</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            let pc_v = serde_json::to_value(pc)?;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            Ok(pc_v)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Err(e) =&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            Err(e)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></section>
<h3 id="lambda-handler">Lambda Handler</h3>
<p>With the shared library code all in place, we can move onto the Lambda&#x27;s main function and its handler.</p>
<style class="ssmq-5">.ssmq-5.ssmq-default{display:block}.ssmq-5:not(.ssmq-default){display: none;}
@media not screen, (max-width: 768px){.ssmq-5.ssmq-notscreenmax-width768px{display:block}.ssmq-5:not(.ssmq-notscreenmax-width768px){display: none;}}</style><div class="ssmq-5 ssmq-notscreenmax-width768px"><section class="ch-scrollycoding-static" data-ch-theme="dark-plus"><p>The Lambda handler code is setup by the <span class="ch-section-link" data-active="false"><code>main</code></span> function which initializes a few key pieces of this puzzle.  The main points to pay attention to are these:</p><ol>
<li>Main includes the Tokio Macro for running it asynchronously.</li>
<li>The <span class="ch-section-link" data-active="false"><code>USER_POOL_ID</code></span> is needed for fetching the JSON Web Key Sets (JWKS)</li>
<li>The <span class="ch-section-link" data-active="false"><code>CLIENT_ID</code></span> is also needed for fetching the JSON Web Key Sets (JWKS)</li>
<li>The fetched JWKS are then shared with each Lambda invocation</li>
</ol><p>With the main function built, let&#x27;s move onto the <span class="ch-section-link" data-active="false"><code>function_handler</code></span></p><p>The handler follows down one of two paths.  It will build a verifier, which it then uses to validate the actual bearer token that is supplied in.  If the token is valid, matches one of the keys in the key set, it is then passed into the <span class="ch-section-link" data-active="false"><code>dump_claims</code></span> function.</p><p>If at any point in this flow an error is encountered or data is missing, then the request is marked as &quot;Deny&quot;.  That allowance is then passed back to the API Gateway which will then either Allow or Deny based upon how the handler evaluated the JWT.  And when the allowance is Allow, the context that is built from the shared library&#x27;s dump_claims will be passed along as well.</p><p>That response is built from <span class="ch-section-link" data-active="false"><code>new_response</code></span></p><div class="ch-codeblock not-prose" data-ch-theme="dark-plus"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>async fn function_handler(</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    client_id: &amp;str,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    key_set: &amp;jsonwebtokens_cognito::KeySet,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    event: LambdaEvent&lt;ApiGatewayCustomAuthorizerRequest&gt;,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>) -&gt; Result&lt;ApiGatewayCustomAuthorizerResponse, AuthorizerError&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let mut allowance = &quot;Allow&quot;;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let mut ctx = serde_json::Value::default();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let verifier = key_set.new_access_token_verifier(&amp;[client_id]).build()?;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let token = event.payload.authorization_token.unwrap();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let bearer = &quot;Bearer &quot;;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    match token.starts_with(bearer) {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        true =&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            let stripped_token = token.replace(bearer, &quot;&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            let claims: Result&lt;serde_json::Value, jsonwebtokens_cognito::Error&gt; =</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                key_set.try_verify(stripped_token.as_str(), &amp;verifier);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            match claims {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                Ok(c) =&gt; ctx = dump_claims(&amp;c)?,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                Err(e) =&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                    error!(&quot;Error dumping claims: {:?}&quot;, e);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                    allowance = &quot;Deny&quot;;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        false =&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            error!(&quot;Error no Bearer prefix&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            allowance = &quot;Deny&quot;;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let response = new_response(allowance, ctx);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    Ok(response)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>#[tokio::main]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>async fn main() -&gt; Result&lt;(), Error&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    tracing_subscriber::fmt()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        .with_max_level(tracing::Level::INFO)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        .with_target(false)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        .without_time()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        .init();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let user_pool_id = &amp;std::env::var(&quot;USER_POOL_ID&quot;).expect(&quot;USER_POOL_ID must be set&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let client_id = &amp;std::env::var(&quot;CLIENT_ID&quot;).expect(&quot;CLIENT_ID must be set&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let key_set = jsonwebtokens_cognito::KeySet::new(&quot;us-west-2&quot;, user_pool_id).unwrap();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let _ = key_set.prefetch_jwks().await;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let shared_key_set = &amp;key_set;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    run(service_fn(</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        move |event: LambdaEvent&lt;ApiGatewayCustomAuthorizerRequest&gt;| async move {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            function_handler(client_id, &amp;shared_key_set, event).await</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        },</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    ))</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    .await</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>fn new_response(effect: &amp;str, ctx: serde_json::Value) -&gt; ApiGatewayCustomAuthorizerResponse {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    ApiGatewayCustomAuthorizerResponse {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        principal_id: None,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        policy_document: ApiGatewayCustomAuthorizerPolicy {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            version: Some(&quot;2012-10-17&quot;.to_owned()),</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            statement: vec![IamPolicyStatement {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                effect: Some(effect.to_owned()),</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                resource: vec![&quot;*&quot;.to_owned()],</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                action: vec![&quot;execute-api:Invoke&quot;.to_owned()],</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            }],</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        },</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        usage_identifier_key: None,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        context: ctx,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></section></div><div class="ssmq-5 ssmq-default"><section class="ch-scrollycoding" data-ch-theme="dark-plus"><div class="ch-scrollycoding-content"><div class="ch-scrollycoding-step-content" data-selected="true"><p>The Lambda handler code is setup by the <span class="ch-section-link" data-active="false"><code>main</code></span> function which initializes a few key pieces of this puzzle.  The main points to pay attention to are these:</p><ol>
<li>Main includes the Tokio Macro for running it asynchronously.</li>
<li>The <span class="ch-section-link" data-active="false"><code>USER_POOL_ID</code></span> is needed for fetching the JSON Web Key Sets (JWKS)</li>
<li>The <span class="ch-section-link" data-active="false"><code>CLIENT_ID</code></span> is also needed for fetching the JSON Web Key Sets (JWKS)</li>
<li>The fetched JWKS are then shared with each Lambda invocation</li>
</ol><p>With the main function built, let&#x27;s move onto the <span class="ch-section-link" data-active="false"><code>function_handler</code></span></p><p>The handler follows down one of two paths.  It will build a verifier, which it then uses to validate the actual bearer token that is supplied in.  If the token is valid, matches one of the keys in the key set, it is then passed into the <span class="ch-section-link" data-active="false"><code>dump_claims</code></span> function.</p><p>If at any point in this flow an error is encountered or data is missing, then the request is marked as &quot;Deny&quot;.  That allowance is then passed back to the API Gateway which will then either Allow or Deny based upon how the handler evaluated the JWT.  And when the allowance is Allow, the context that is built from the shared library&#x27;s dump_claims will be passed along as well.</p><p>That response is built from <span class="ch-section-link" data-active="false"><code>new_response</code></span></p></div></div><div class="ch-scrollycoding-sticker"><div class="ch-codeblock not-prose" data-ch-theme="dark-plus"><div class="ch-code-wrapper ch-code" data-ch-measured="false"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>async fn function_handler(</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    client_id: &amp;str,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    key_set: &amp;jsonwebtokens_cognito::KeySet,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    event: LambdaEvent&lt;ApiGatewayCustomAuthorizerRequest&gt;,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>) -&gt; Result&lt;ApiGatewayCustomAuthorizerResponse, AuthorizerError&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let mut allowance = &quot;Allow&quot;;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let mut ctx = serde_json::Value::default();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let verifier = key_set.new_access_token_verifier(&amp;[client_id]).build()?;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let token = event.payload.authorization_token.unwrap();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let bearer = &quot;Bearer &quot;;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    match token.starts_with(bearer) {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        true =&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            let stripped_token = token.replace(bearer, &quot;&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            let claims: Result&lt;serde_json::Value, jsonwebtokens_cognito::Error&gt; =</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                key_set.try_verify(stripped_token.as_str(), &amp;verifier);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            match claims {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                Ok(c) =&gt; ctx = dump_claims(&amp;c)?,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                Err(e) =&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                    error!(&quot;Error dumping claims: {:?}&quot;, e);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                    allowance = &quot;Deny&quot;;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        false =&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            error!(&quot;Error no Bearer prefix&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            allowance = &quot;Deny&quot;;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let response = new_response(allowance, ctx);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    Ok(response)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>#[tokio::main]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>async fn main() -&gt; Result&lt;(), Error&gt; {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    tracing_subscriber::fmt()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        .with_max_level(tracing::Level::INFO)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        .with_target(false)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        .without_time()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        .init();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let user_pool_id = &amp;std::env::var(&quot;USER_POOL_ID&quot;).expect(&quot;USER_POOL_ID must be set&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let client_id = &amp;std::env::var(&quot;CLIENT_ID&quot;).expect(&quot;CLIENT_ID must be set&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let key_set = jsonwebtokens_cognito::KeySet::new(&quot;us-west-2&quot;, user_pool_id).unwrap();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let _ = key_set.prefetch_jwks().await;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    let shared_key_set = &amp;key_set;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    run(service_fn(</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        move |event: LambdaEvent&lt;ApiGatewayCustomAuthorizerRequest&gt;| async move {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            function_handler(client_id, &amp;shared_key_set, event).await</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        },</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    ))</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    .await</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>fn new_response(effect: &amp;str, ctx: serde_json::Value) -&gt; ApiGatewayCustomAuthorizerResponse {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    ApiGatewayCustomAuthorizerResponse {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        principal_id: None,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        policy_document: ApiGatewayCustomAuthorizerPolicy {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            version: Some(&quot;2012-10-17&quot;.to_owned()),</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            statement: vec![IamPolicyStatement {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                effect: Some(effect.to_owned()),</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                resource: vec![&quot;*&quot;.to_owned()],</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>                action: vec![&quot;execute-api:Invoke&quot;.to_owned()],</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            }],</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        },</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        usage_identifier_key: None,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        context: ctx,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></section></div><script class="ssmq-5">!function(){for(var e=["not screen, (max-width: 768px)","default"],t=["ssmq-notscreenmax-width768px","ssmq-default"],o="ssmq-5",r=document.getElementsByTagName("script"),c=r[r.length-1].parentNode,s=null,a=0;a<e.length-1;a++)if(window.matchMedia(e[a]).matches){s=c.querySelector(":scope > ."+o+"."+t[a]);break}if(!s){var n=t.pop();s=c.querySelector(":scope > ."+o+"."+n)}s.removeAttribute("class"),c.querySelectorAll(":scope > ."+o).forEach((function(e){c.removeChild(e)}))}()</script>
<h2 id="congratulations">Congratulations</h2>
<p>Congratulations, you now have a Lambda Function that will work as a custom authorizer that can be plugged into an API Gateway.  And this Lambda is coded in Rust, so you can rest assured, it is secure and blazing fast!</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/security"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Security</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/patterns/security-patterns/congito-token-customization"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cognito Token Customization</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it Works</a></li><li><a href="#project-structure" class="table-of-contents__link toc-highlight">Project Structure</a></li><li><a href="#lambda-code" class="table-of-contents__link toc-highlight">Lambda Code</a><ul><li><a href="#shared-code" class="table-of-contents__link toc-highlight">Shared Code</a></li><li><a href="#lambda-handler" class="table-of-contents__link toc-highlight">Lambda Handler</a></li></ul></li><li><a href="#congratulations" class="table-of-contents__link toc-highlight">Congratulations</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/why-rust">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Built by @plantpowerjames and @benjamenpyle</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/plantpowerjames" target="_blank" rel="noopener noreferrer" class="footer__link-item">@plantpowerjames</a></li><li class="footer__item"><a href="https://twitter.com/benjamenpyle" target="_blank" rel="noopener noreferrer" class="footer__link-item">@benjamenpyle</a></li><li class="footer__item"><a href="https://github.com/serverlessdevelopers/serverless-rust/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report Issues on GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Serverless Rust. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>