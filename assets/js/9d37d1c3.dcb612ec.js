"use strict";(self.webpackChunkinteractive_docs=self.webpackChunkinteractive_docs||[]).push([[9645],{5355:(o,t,e)=>{e.r(t),e.d(t,{CH:()=>y,assets:()=>D,chCodeConfig:()=>a,contentTitle:()=>l,default:()=>C,frontMatter:()=>r,metadata:()=>p,toc:()=>i});e(6540);var n=e(4848),s=e(8453),c=e(4754);const r={sidebar_position:1,title:"Code Deploy Lifecycle Hook",description:"Implementig a CodeDeploy LifeCycle Hook",keywords:["rust","lambda","ci/cd","lifecycle","codedeploy"]},l=void 0,p={id:"patterns/ci-cd-patterns/code-deploy-lifecycle-hook",title:"Code Deploy Lifecycle Hook",description:"Implementig a CodeDeploy LifeCycle Hook",source:"@site/docs/patterns/ci-cd-patterns/code-deploy-lifecycle-hook.md",sourceDirName:"patterns/ci-cd-patterns",slug:"/patterns/ci-cd-patterns/code-deploy-lifecycle-hook",permalink:"/docs/patterns/ci-cd-patterns/code-deploy-lifecycle-hook",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Code Deploy Lifecycle Hook",description:"Implementig a CodeDeploy LifeCycle Hook",keywords:["rust","lambda","ci/cd","lifecycle","codedeploy"]},sidebar:"tutorialSidebar",previous:{title:"CI/CD",permalink:"/docs/category/cicd-1"},next:{title:"Containers",permalink:"/docs/category/containers"}},D={},i=[{value:"Introduction",id:"introduction",level:2},{value:"Sample Solution",id:"sample-solution",level:2},{value:"Main Function",id:"main-function",level:3},{value:"Handler",id:"handler",level:3},{value:"Run Test Function",id:"run-test-function",level:3},{value:"Seeing it in Action",id:"seeing-it-in-action",level:2},{value:"Congratulations",id:"congratulations",level:2}],y={annotations:c.hk,Section:c.wn,SectionLink:c.W_,SectionCode:c.bx},a={staticMediaQuery:"not screen, (max-width: 768px)",lineNumbers:void 0,showCopyButton:void 0,themeName:"dark-plus"};function d(o){const t=Object.assign({h2:"h2",p:"p",a:"a",blockquote:"blockquote",ol:"ol",li:"li",h3:"h3",code:"code",img:"img"},(0,s.R)(),o.components);return y||h("CH",!1),y.Section||h("CH.Section",!0),y.SectionCode||h("CH.SectionCode",!0),y.SectionLink||h("CH.SectionLink",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("style",{dangerouslySetInnerHTML:{__html:'[data-ch-theme="dark-plus"] {  --ch-t-colorScheme: dark;--ch-t-foreground: #D4D4D4;--ch-t-background: #1E1E1E;--ch-t-lighter-inlineBackground: #1e1e1ee6;--ch-t-editor-background: #1E1E1E;--ch-t-editor-foreground: #D4D4D4;--ch-t-editor-rangeHighlightBackground: #ffffff0b;--ch-t-editor-infoForeground: #3794FF;--ch-t-editor-selectionBackground: #264F78;--ch-t-focusBorder: #007FD4;--ch-t-tab-activeBackground: #1E1E1E;--ch-t-tab-activeForeground: #ffffff;--ch-t-tab-inactiveBackground: #2D2D2D;--ch-t-tab-inactiveForeground: #ffffff80;--ch-t-tab-border: #252526;--ch-t-tab-activeBorder: #1E1E1E;--ch-t-editorGroup-border: #444444;--ch-t-editorGroupHeader-tabsBackground: #252526;--ch-t-editorLineNumber-foreground: #858585;--ch-t-input-background: #3C3C3C;--ch-t-input-foreground: #D4D4D4;--ch-t-icon-foreground: #C5C5C5;--ch-t-sideBar-background: #252526;--ch-t-sideBar-foreground: #D4D4D4;--ch-t-sideBar-border: #252526;--ch-t-list-activeSelectionBackground: #094771;--ch-t-list-activeSelectionForeground: #fffffe;--ch-t-list-hoverBackground: #2A2D2E; }'}}),"\n",(0,n.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://aws.amazon.com/codedeploy/",children:"AWS CodeDeploy"})," is a fully managed deployment coordinator that provides flexiblity during the deployment lifecyle.  It can be defined like this:"]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"AWS CodeDeploy is a fully managed deployment service that automates software deployments to various compute services, such as Amazon Elastic Compute Cloud (EC2), Amazon Elastic Container Service (ECS), AWS Lambda, and your on-premises servers. Use CodeDeploy to automate software deployments, eliminating the need for error-prone manual operations. - AWS"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"CodeDeploy provides 5 unique hooks that are implemented with a Lambda Function.  They are:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"BeforeInstall"}),"\n",(0,n.jsx)(t.li,{children:"AfterInstall"}),"\n",(0,n.jsx)(t.li,{children:"AfterAllowTestTraffic"}),"\n",(0,n.jsx)(t.li,{children:"BeforeAllowTraffic"}),"\n",(0,n.jsx)(t.li,{children:"AfterAllowTraffic"}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["To read more in detail ",(0,n.jsx)(t.a,{href:"https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html#reference-appspec-file-structure-hooks-list-ecs",children:"here's the documentation"})]}),"\n",(0,n.jsx)(t.h2,{id:"sample-solution",children:"Sample Solution"}),"\n",(0,n.jsxs)(t.p,{children:["A template for this pattern can be found under the ",(0,n.jsx)(t.a,{href:"https://github.com/serverlessdevelopers/serverless-rust/tree/main/templates/patterns/ci-cd-patterns/codedeploy-lifecycle-hook/",children:"./templates"})," directory in the GitHub repo. You can use the template to get started building with CodeDeploy LifeCycle Hooks and Lambda."]}),"\n",(0,n.jsx)(t.h3,{id:"main-function",children:"Main Function"}),"\n",(0,n.jsxs)(y.Section,{codeConfig:a,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"#[tokio::main]",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"async fn ",props:{style:{color:"#569CD6"}}},{content:"main",props:{style:{color:"#DCDCAA"}}},{content:"() -> ",props:{style:{color:"#D4D4D4"}}},{content:"Result",props:{style:{color:"#4EC9B0"}}},{content:"<(), ",props:{style:{color:"#D4D4D4"}}},{content:"Error",props:{style:{color:"#4EC9B0"}}},{content:"> {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    tracing_subscriber",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"fmt",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"with_max_level",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"tracing",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"Level",props:{style:{color:"#4EC9B0"}}},{content:"::INFO)",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"json",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"with_target",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"false",props:{style:{color:"#569CD6"}}},{content:")",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"without_time",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"init",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"alb_url",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"std",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"env",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"var",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"ALB_URL"',props:{style:{color:"#CE9178"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"expect",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"ALB_URL must be set"',props:{style:{color:"#CE9178"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"alb_str",props:{style:{color:"#9CDCFE"}}},{content:" = &",props:{style:{color:"#D4D4D4"}}},{content:"alb_url",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"as_str",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    run",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"service_fn",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        move",props:{style:{color:"#569CD6"}}},{content:" |",props:{style:{color:"#D4D4D4"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"LambdaEvent",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"HashMap",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:">>| ",props:{style:{color:"#D4D4D4"}}},{content:"async move",props:{style:{color:"#569CD6"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            function_handler",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"alb_str",props:{style:{color:"#9CDCFE"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}}]},{tokens:[{content:"        },",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    )).",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}}]},{tokens:[{content:"}",props:{style:{color:"#D4D4D4"}}}]}],lang:"rust"},annotations:[]}],children:[(0,n.jsxs)(t.p,{children:["Rust programs start off with a ",(0,n.jsx)(y.SectionLink,{focus:"2",id:"focus://2",children:(0,n.jsx)(t.code,{children:"main"})})," function.  The main function in this sample includes the ",(0,n.jsx)(y.SectionLink,{focus:"1",id:"focus://1",children:(0,n.jsx)(t.code,{children:"Tokio"})})," macro so that this main can run asynchronous code."]}),(0,n.jsxs)(t.p,{children:["The only piece of this function that is required is an environment variable named ",(0,n.jsx)(y.SectionLink,{focus:"11",id:"focus://11",children:(0,n.jsx)(t.code,{children:"ALB_URL"})}),".  The\npurpose of that variable is to allow the function to read the application load balancer that it can send a request or series of requests to on the test target group."]}),(0,n.jsx)(y.SectionCode,{})]}),"\n",(0,n.jsx)(t.h3,{id:"handler",children:"Handler"}),"\n",(0,n.jsxs)(t.p,{children:["Every time this function is triggered, it's going to receive a payload of ",(0,n.jsx)(t.code,{children:"HashMap<String, String>"}),".  As of this writing, the Rust Lambda Events project hasn't published the code that supports a strongly-typed struct.  For reference, ",(0,n.jsx)(t.a,{href:"https://github.com/awslabs/aws-lambda-rust-runtime/blob/de822f9d870c21c06b504d218293099f691ced9f/lambda-events/src/event/codedeploy/mod.rs#L68",children:"here is that code"})]}),"\n",(0,n.jsxs)(y.Section,{codeConfig:a,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"async fn ",props:{style:{color:"#569CD6"}}},{content:"function_handler",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"alb_url",props:{style:{color:"#9CDCFE"}}},{content:": &",props:{style:{color:"#D4D4D4"}}},{content:"str",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"LambdaEvent",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"HashMap",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:">>) -> ",props:{style:{color:"#D4D4D4"}}},{content:"Result",props:{style:{color:"#4EC9B0"}}},{content:"<(), ",props:{style:{color:"#D4D4D4"}}},{content:"Error",props:{style:{color:"#4EC9B0"}}},{content:"> {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"deployment_id",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:".payload.",props:{style:{color:"#D4D4D4"}}},{content:"get",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"DeploymentId"',props:{style:{color:"#CE9178"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"unwrap",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"lifecycle_event_hook_execution_id",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:".payload.",props:{style:{color:"#D4D4D4"}}},{content:"get",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"LifecycleEventHookExecutionId"',props:{style:{color:"#CE9178"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"unwrap",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"config",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"aws_config",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"load_from_env",props:{style:{color:"#DCDCAA"}}},{content:"().",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}},{content:";",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"client",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"Client",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"new",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"config",props:{style:{color:"#9CDCFE"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let mut ",props:{style:{color:"#569CD6"}}},{content:"passed",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"true",props:{style:{color:"#569CD6"}}},{content:";",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:'    // replaces the "one" to the route that needs to be exercised',props:{style:{color:"#6A9955"}}}]},{tokens:[{content:"    if ",props:{style:{color:"#C586C0"}}},{content:"let ",props:{style:{color:"#569CD6"}}},{content:"Err",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"_",props:{style:{color:"#9CDCFE"}}},{content:") = ",props:{style:{color:"#D4D4D4"}}},{content:"run_test",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"alb_url",props:{style:{color:"#9CDCFE"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:'"one"',props:{style:{color:"#CE9178"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"to_string",props:{style:{color:"#DCDCAA"}}},{content:"()).",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        info!",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"Test on Route one failed, rolling back"',props:{style:{color:"#CE9178"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        passed",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"false",props:{style:{color:"#569CD6"}}}]},{tokens:[{content:"    }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"status",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"if ",props:{style:{color:"#C586C0"}}},{content:"passed",props:{style:{color:"#9CDCFE"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        LifecycleEventStatus",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"Succeeded",props:{style:{color:"#4EC9B0"}}}]},{tokens:[{content:"    } ",props:{style:{color:"#D4D4D4"}}},{content:"else",props:{style:{color:"#C586C0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        LifecycleEventStatus",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"Failed",props:{style:{color:"#4EC9B0"}}}]},{tokens:[{content:"    };",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"cloned",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"status",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"clone",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    client",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"put_lifecycle_event_hook_execution_status",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"deployment_id",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"deployment_id",props:{style:{color:"#9CDCFE"}}},{content:")",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"lifecycle_event_hook_execution_id",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"lifecycle_event_hook_execution_id",props:{style:{color:"#9CDCFE"}}},{content:")",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"status",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"status",props:{style:{color:"#9CDCFE"}}},{content:")",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"send",props:{style:{color:"#DCDCAA"}}},{content:"().",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}},{content:"?;",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    info!",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"Wrapping up requests with a status of: {:?}"',props:{style:{color:"#CE9178"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"cloned",props:{style:{color:"#9CDCFE"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    Ok",props:{style:{color:"#4EC9B0"}}},{content:"(())",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"}",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]}],lang:"rust"},annotations:[]}],children:[(0,n.jsx)(t.p,{children:"Let's dig through what all is happening."}),(0,n.jsxs)(t.p,{children:["The first part of this handler is fetching out the values from the payload.  We need to use the ",(0,n.jsx)(y.SectionLink,{focus:"2",id:"focus://2",children:(0,n.jsx)(t.code,{children:"deployment_id"})})," and ",(0,n.jsx)(y.SectionLink,{focus:"3",id:"focus://3",children:(0,n.jsx)(t.code,{children:"lifecycle_event_hook_execution_id"})})," to signal back to the CodeDeploy execution whether this deployment should continue or fail."]}),(0,n.jsx)(t.p,{children:"A quick note when looking at those two lines of code, I'm unwrapping the get operation.  While I normally don't recommend this, I'm confident that AWS is goig to send me what I expect.  If I was to test this with faulty payloads, you would get an exception."}),(0,n.jsxs)(t.p,{children:[(0,n.jsx)(y.SectionLink,{focus:"11",id:"focus://11",children:(0,n.jsx)(t.code,{children:"Line 11"})})," shows a call to ",(0,n.jsx)(y.SectionLink,{focus:"11[21:28]",id:"focus://11[21:28]",children:(0,n.jsx)(t.code,{children:"run_test"})}),".  We'll explore that function below but it's purpose is to run a path on the ALB_URL that was supplied through environment variables.  Based on the output of that function, the handler will decide to either ",(0,n.jsx)(y.SectionLink,{focus:"17",id:"focus://17",children:(0,n.jsx)(t.code,{children:"Succeed"})})," or ",(0,n.jsx)(y.SectionLink,{focus:"19",id:"focus://19",children:(0,n.jsx)(t.code,{children:"Fail"})})," the CodeDeploy deployment."]}),(0,n.jsxs)(t.p,{children:["That status will then be based back through the ",(0,n.jsx)(y.SectionLink,{focus:"23:27",id:"focus://23:27",children:(0,n.jsx)(t.code,{children:"put_lifecycle_event_hook_execution_status"})})]}),(0,n.jsx)(y.SectionCode,{})]}),"\n",(0,n.jsx)(t.h3,{id:"run-test-function",children:"Run Test Function"}),"\n",(0,n.jsxs)(y.Section,{codeConfig:a,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"async fn ",props:{style:{color:"#569CD6"}}},{content:"run_test",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"url",props:{style:{color:"#9CDCFE"}}},{content:": &",props:{style:{color:"#D4D4D4"}}},{content:"str",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"path",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:") -> ",props:{style:{color:"#D4D4D4"}}},{content:"Result",props:{style:{color:"#4EC9B0"}}},{content:"<(), ",props:{style:{color:"#D4D4D4"}}},{content:"Error",props:{style:{color:"#4EC9B0"}}},{content:"> {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"request_url",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"format!",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"http://{url}/{path}"',props:{style:{color:"#CE9178"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"url",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"url",props:{style:{color:"#9CDCFE"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"path",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"path",props:{style:{color:"#9CDCFE"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    info!",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"{}"',props:{style:{color:"#CE9178"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"request_url",props:{style:{color:"#9CDCFE"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"timeout",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"Duration",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"new",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"2",props:{style:{color:"#B5CEA8"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"0",props:{style:{color:"#B5CEA8"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"client",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"ClientBuilder",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"new",props:{style:{color:"#DCDCAA"}}},{content:"().",props:{style:{color:"#D4D4D4"}}},{content:"timeout",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"timeout",props:{style:{color:"#9CDCFE"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"build",props:{style:{color:"#DCDCAA"}}},{content:"()?;",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"response",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"client",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"head",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"request_url",props:{style:{color:"#9CDCFE"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"send",props:{style:{color:"#DCDCAA"}}},{content:"().",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}},{content:"?;",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    if ",props:{style:{color:"#C586C0"}}},{content:"response",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"status",props:{style:{color:"#DCDCAA"}}},{content:"().",props:{style:{color:"#D4D4D4"}}},{content:"is_success",props:{style:{color:"#DCDCAA"}}},{content:"() {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        Ok",props:{style:{color:"#4EC9B0"}}},{content:"(())",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    } ",props:{style:{color:"#D4D4D4"}}},{content:"else",props:{style:{color:"#C586C0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        Err",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"format!",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"Error: {}"',props:{style:{color:"#CE9178"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"response",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"status",props:{style:{color:"#DCDCAA"}}},{content:"()).",props:{style:{color:"#D4D4D4"}}},{content:"into",props:{style:{color:"#DCDCAA"}}},{content:"())",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"}",props:{style:{color:"#D4D4D4"}}}]}],lang:"rust"},annotations:[]}],children:[(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(y.SectionLink,{focus:"1[10:17]",id:"focus://1[10:17]",children:(0,n.jsx)(t.code,{children:"run_test"})})," function accepts a url and path and then executes an HTTP request on the full URL built by those inputs.  As long as the endpoint returns anything ",(0,n.jsx)(y.SectionLink,{focus:"9",id:"focus://9",children:(0,n.jsx)(t.code,{children:"2xx"})}),", the handler will consider the execution a success.  Anything else, and an ",(0,n.jsx)(y.SectionLink,{focus:"12",id:"focus://12",children:(0,n.jsx)(t.code,{children:"error"})})]}),(0,n.jsx)(y.SectionCode,{})]}),"\n",(0,n.jsx)(t.h2,{id:"seeing-it-in-action",children:"Seeing it in Action"}),"\n",(0,n.jsx)(t.p,{children:"With all of this in place and attached to a CodeDeploy, you'll see output like this.  A CodeDeploy executing or skipping the hooks that have been defined just like the Lambda Function code above."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:e(1579).A+"",loading:"lazy",alt:"CodeDeploy Lambda Function Hooks",width:"2716",height:"868"})}),"\n",(0,n.jsx)(t.h2,{id:"congratulations",children:"Congratulations"}),"\n",(0,n.jsx)(t.p,{children:"And that's it! Congratulations, you now know how to implement a CodeDeploy LifeCycle Hook in Lambda with Rust!"})]})}const C=function(o={}){const{wrapper:t}=Object.assign({},(0,s.R)(),o.components);return t?(0,n.jsx)(t,Object.assign({},o,{children:(0,n.jsx)(d,o)})):d(o)};function h(o,t){throw new Error("Expected "+(t?"component":"object")+" `"+o+"` to be defined: you likely forgot to import, pass, or provide it.")}},1579:(o,t,e)=>{e.d(t,{A:()=>n});const n=e.p+"assets/images/code_deploy-88757efc7f88a69cf9494c800d3c9d16.png"}}]);