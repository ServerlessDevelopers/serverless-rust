"use strict";(self.webpackChunkinteractive_docs=self.webpackChunkinteractive_docs||[]).push([[7028],{7248:(o,t,e)=>{e.r(t),e.d(t,{CH:()=>a,assets:()=>D,chCodeConfig:()=>y,contentTitle:()=>l,default:()=>C,frontMatter:()=>c,metadata:()=>p,toc:()=>i});e(6540);var n=e(4848),s=e(8453),r=e(4754);const c={sidebar_position:2,title:"Cognito Token Customization",description:"Lambda function for customizing Cognito Access and ID tokens",keywords:["rust","lambda","cognito","security"]},l=void 0,p={id:"patterns/security-patterns/congito-token-customization",title:"Cognito Token Customization",description:"Lambda function for customizing Cognito Access and ID tokens",source:"@site/docs/patterns/security-patterns/congito-token-customization.md",sourceDirName:"patterns/security-patterns",slug:"/patterns/security-patterns/congito-token-customization",permalink:"/docs/patterns/security-patterns/congito-token-customization",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Cognito Token Customization",description:"Lambda function for customizing Cognito Access and ID tokens",keywords:["rust","lambda","cognito","security"]},sidebar:"tutorialSidebar",previous:{title:"API Gateway Token Authorizer",permalink:"/docs/patterns/security-patterns/api-gateway-token-authorizer"}},D={},i=[{value:"How It Works",id:"how-it-works",level:2},{value:"Project Structure",id:"project-structure",level:2},{value:"Lambda Code",id:"lambda-code",level:2},{value:"Main Function",id:"main-function",level:3},{value:"Shared Code",id:"shared-code",level:3},{value:"User Model",id:"user-model",level:4},{value:"DynamoDB Get Item",id:"dynamodb-get-item",level:4},{value:"Handler Code",id:"handler-code",level:3},{value:"Displaying the Output",id:"displaying-the-output",level:2},{value:"Congratulations",id:"congratulations",level:2}],a={annotations:r.hk,Code:r.Cy,Section:r.wn,SectionLink:r.W_,SectionCode:r.bx,Scrollycoding:r.Fk,CodeSlot:r.Wu},y={staticMediaQuery:"not screen, (max-width: 768px)",lineNumbers:void 0,showCopyButton:void 0,themeName:"dark-plus"};function d(o){const t=Object.assign({p:"p",blockquote:"blockquote",h2:"h2",a:"a",h3:"h3",code:"code",ul:"ul",li:"li",h4:"h4",em:"em",img:"img"},(0,s.R)(),o.components);return a||h("CH",!1),a.Code||h("CH.Code",!0),a.CodeSlot||h("CH.CodeSlot",!0),a.Scrollycoding||h("CH.Scrollycoding",!0),a.Section||h("CH.Section",!0),a.SectionCode||h("CH.SectionCode",!0),a.SectionLink||h("CH.SectionLink",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("style",{dangerouslySetInnerHTML:{__html:'[data-ch-theme="dark-plus"] {  --ch-t-colorScheme: dark;--ch-t-foreground: #D4D4D4;--ch-t-background: #1E1E1E;--ch-t-lighter-inlineBackground: #1e1e1ee6;--ch-t-editor-background: #1E1E1E;--ch-t-editor-foreground: #D4D4D4;--ch-t-editor-rangeHighlightBackground: #ffffff0b;--ch-t-editor-infoForeground: #3794FF;--ch-t-editor-selectionBackground: #264F78;--ch-t-focusBorder: #007FD4;--ch-t-tab-activeBackground: #1E1E1E;--ch-t-tab-activeForeground: #ffffff;--ch-t-tab-inactiveBackground: #2D2D2D;--ch-t-tab-inactiveForeground: #ffffff80;--ch-t-tab-border: #252526;--ch-t-tab-activeBorder: #1E1E1E;--ch-t-editorGroup-border: #444444;--ch-t-editorGroupHeader-tabsBackground: #252526;--ch-t-editorLineNumber-foreground: #858585;--ch-t-input-background: #3C3C3C;--ch-t-input-foreground: #D4D4D4;--ch-t-icon-foreground: #C5C5C5;--ch-t-sideBar-background: #252526;--ch-t-sideBar-foreground: #D4D4D4;--ch-t-sideBar-border: #252526;--ch-t-list-activeSelectionBackground: #094771;--ch-t-list-activeSelectionForeground: #fffffe;--ch-t-list-hoverBackground: #2A2D2E; }'}}),"\n",(0,n.jsx)(t.p,{children:"Applications require security.  There isn't a debate here, they just do.  And serverless applications are no different.  One of the knocks against serverless is that it isn't secure.  That's 100% a false narrative.  However, serverless paired with Infrastructure as Code (IaC) can make it easy sometimes to ship things that do lack the proper controls."}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"AWS' Congitio is an product that aims to provide a frictionless customer identity and access management platform.  - AWS"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"If something is frictionless though, does it allow customization?  Cognito provides numerous customization endpoints and one that is often most useful is providing the ability to shape the OAuth2 ID and Access tokens that are represented as JSON Web Tokens (JWT)."}),"\n",(0,n.jsx)(t.p,{children:"Let's take a look at how to make that happen."}),"\n",(0,n.jsx)(t.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,n.jsx)(t.p,{children:'Cognito offers a builder a number of Lambda "hooks" that can be taken advantage of to tailor the user\'s sign in, sign up, and log out experience.  These are normal Lambda functions that have Cognito payloads the provide the context and information needed to shape the JWT outputs.'}),"\n",(0,n.jsx)(t.p,{children:"In this example, we are going to use DynamoDB as a datastore to provide additional information about the Cognito UserPool users so that we can add extra values into the claims of the two JWTs.  Remember, and for clarification:"}),"\n",(0,n.jsx)(t.p,{children:"By adding some claims to the access token we can speed up the authorization process by not having to fetch key pieces of data needed to perform those authorizations. By sprinkling in key claims to the ID token, the client or UI can alter the user\u2019s experience without needing to fetch those additional details."}),"\n",(0,n.jsx)(t.p,{children:"One last point to note, in order to customize access tokens, you must turn on the advanced security features in Cognito.  This does come with an additional cost, so just be aware."}),"\n",(0,n.jsx)(t.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,n.jsx)(t.p,{children:"This starter project is organized around a single Lambda handler with a shared library crate can be used for data access and models.  However, don't take simple for not powerful, because in one function we can customize both of the Cognito tokens."}),"\n",(0,n.jsx)(a.Code,{codeConfig:y,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"lambdas/",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"   handler/",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"   shared/",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"Cargo.toml",props:{style:{color:"#D4D4D4"}}}]}],lang:"bash"},annotations:[]}]}),"\n",(0,n.jsxs)(t.p,{children:["A template that we will be working from that exercises the customization of Cognito tokens with Lambda is found under the ",(0,n.jsx)(t.a,{href:"https://github.com/serverlessdevelopers/serverless-rust/tree/main/templates/patterns/security-patterns/cognito-token-customizer",children:"./templates"})," directory in the GitHub repo. You can use template to get started building with Cognito and Lambda."]}),"\n",(0,n.jsx)(t.h2,{id:"lambda-code",children:"Lambda Code"}),"\n",(0,n.jsx)(t.p,{children:"Let's walk through the Lambda handler, main function, and shared library code to get a sense for what all you can do with Cognito, Rust and Lambda."}),"\n",(0,n.jsx)(t.h3,{id:"main-function",children:"Main Function"}),"\n",(0,n.jsxs)(a.Section,{codeConfig:y,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"#[tokio::main]",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"async fn ",props:{style:{color:"#569CD6"}}},{content:"main",props:{style:{color:"#DCDCAA"}}},{content:"() -> ",props:{style:{color:"#D4D4D4"}}},{content:"Result",props:{style:{color:"#4EC9B0"}}},{content:"<(), ",props:{style:{color:"#D4D4D4"}}},{content:"Error",props:{style:{color:"#4EC9B0"}}},{content:"> {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    tracing_subscriber",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"fmt",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"with_max_level",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"tracing",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"Level",props:{style:{color:"#4EC9B0"}}},{content:"::INFO)",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"with_target",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"false",props:{style:{color:"#569CD6"}}},{content:")",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"without_time",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"init",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"table_name",props:{style:{color:"#9CDCFE"}}},{content:" = &",props:{style:{color:"#D4D4D4"}}},{content:"std",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"env",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"var",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"TABLE_NAME"',props:{style:{color:"#CE9178"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"expect",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"TABLE_NAME must be set"',props:{style:{color:"#CE9178"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"config",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"aws_config",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"load_from_env",props:{style:{color:"#DCDCAA"}}},{content:"().",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}},{content:";",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"client",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"Client",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"new",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"config",props:{style:{color:"#9CDCFE"}}},{content:");",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"shared_client",props:{style:{color:"#9CDCFE"}}},{content:" = &",props:{style:{color:"#D4D4D4"}}},{content:"client",props:{style:{color:"#9CDCFE"}}},{content:";",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    run",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"service_fn",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        move",props:{style:{color:"#569CD6"}}},{content:" |",props:{style:{color:"#D4D4D4"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"LambdaEvent",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"CognitoEventUserPoolsPreTokenGenV2",props:{style:{color:"#4EC9B0"}}},{content:">| ",props:{style:{color:"#D4D4D4"}}},{content:"async move",props:{style:{color:"#569CD6"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            function_handler",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"shared_client",props:{style:{color:"#9CDCFE"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"table_name",props:{style:{color:"#9CDCFE"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}}]},{tokens:[{content:"        },",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    )).",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}}]},{tokens:[{content:"}",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]}],lang:"rust"},annotations:[]}],children:[(0,n.jsx)(t.p,{children:"The main function of a Rust Lambda handler will often look very similar.  It usually exists to initialize some shared resources, configure tracing, and then provide the entry point to the Lambda Handler code."}),(0,n.jsxs)(t.p,{children:["In this sample repository, the main function will do just those things.  Notice that the ",(0,n.jsx)(a.SectionLink,{focus:"9[38:47]",id:"focus://9[38:47]",children:(0,n.jsx)(t.code,{children:"TABLE_NAME"})})," environment variable is required as it'll be used when querying the DynamoDB table that supports the user customization."]}),(0,n.jsxs)(t.p,{children:["We are also creating a ",(0,n.jsx)(a.SectionLink,{focus:"12[9:21]",id:"focus://12[9:21]",children:(0,n.jsx)(t.code,{children:"shared_client"})})," which is a good best practice as the reference will be reused on each Lambda event that is handled."]}),(0,n.jsx)(a.SectionCode,{})]}),"\n",(0,n.jsx)(t.h3,{id:"shared-code",children:"Shared Code"}),"\n",(0,n.jsx)(t.p,{children:"Let's work through the shared code first because it'll be used extensively in the Lambda's handler implementation."}),"\n",(0,n.jsx)(t.p,{children:"The shared library crate is comprised of two modules:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"data: interacts with DynamoDB"}),"\n",(0,n.jsx)(t.li,{children:"models: defines shape and behaviors for the structs and enums"}),"\n"]}),"\n",(0,n.jsx)(t.h4,{id:"user-model",children:"User Model"}),"\n",(0,n.jsx)(t.p,{children:"The primary model that we'll be working with is the User model.  It holds data that will be leveraged for customizing the two tokens.  It aslo has an implementation that helps with returning field values.  I find it's a good idea to hide the data implementation and provider accessors that are needed for the consumers of the crate."}),"\n",(0,n.jsxs)(a.Section,{codeConfig:y,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"#[derive(",props:{style:{color:"#D4D4D4"}}},{content:"Serialize",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"Deserialize",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"Debug",props:{style:{color:"#4EC9B0"}}},{content:")]",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"pub struct ",props:{style:{color:"#569CD6"}}},{content:"User",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    id",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    user_id",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    first_name",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    last_name",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    interesting_value",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"}",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"impl ",props:{style:{color:"#569CD6"}}},{content:"User",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    pub fn ",props:{style:{color:"#569CD6"}}},{content:"get_first_name",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"self",props:{style:{color:"#569CD6"}}},{content:") -> ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        String",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"from",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"self",props:{style:{color:"#569CD6"}}},{content:".first_name)",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    pub fn ",props:{style:{color:"#569CD6"}}},{content:"get_last_name",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"self",props:{style:{color:"#569CD6"}}},{content:") -> ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        String",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"from",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"self",props:{style:{color:"#569CD6"}}},{content:".last_name)",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    pub fn ",props:{style:{color:"#569CD6"}}},{content:"get_interesting_value",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"self",props:{style:{color:"#569CD6"}}},{content:") -> ",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        String",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"from",props:{style:{color:"#DCDCAA"}}},{content:"(&",props:{style:{color:"#D4D4D4"}}},{content:"self",props:{style:{color:"#569CD6"}}},{content:".interesting_value)",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"}",props:{style:{color:"#D4D4D4"}}}]}],lang:"rust"},annotations:[]}],children:[(0,n.jsxs)(t.p,{children:["The User model has ",(0,n.jsx)(a.SectionLink,{focus:"1",id:"focus://1",children:(0,n.jsx)(t.code,{children:"macros"})})," for handling serlialization, deserialization and debug functionality."]}),(0,n.jsx)(t.p,{children:"The first_name, last_name and interesting_value will be used for the token but you could easily replace these values with your custom needs."}),(0,n.jsx)(a.SectionCode,{})]}),"\n",(0,n.jsx)(t.p,{children:"In addition to the User model, this mod contains an enum for custom errors.  Custom error handling in Rust allows the developer to organize failures into common conventions that provide cleaner Result values in addition to clarity in the interfaces."}),"\n",(0,n.jsx)(t.h4,{id:"dynamodb-get-item",children:"DynamoDB Get Item"}),"\n",(0,n.jsxs)(a.Section,{codeConfig:y,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"pub async fn ",props:{style:{color:"#569CD6"}}},{content:"fetch_item",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"client",props:{style:{color:"#9CDCFE"}}},{content:": &",props:{style:{color:"#D4D4D4"}}},{content:"Client",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"table_name",props:{style:{color:"#9CDCFE"}}},{content:": &",props:{style:{color:"#D4D4D4"}}},{content:"str",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"id",props:{style:{color:"#9CDCFE"}}},{content:": &",props:{style:{color:"#D4D4D4"}}},{content:"str",props:{style:{color:"#4EC9B0"}}},{content:") -> ",props:{style:{color:"#D4D4D4"}}},{content:"Result",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"User",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"QueryError",props:{style:{color:"#4EC9B0"}}},{content:"> {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"key",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:'"USER#"',props:{style:{color:"#CE9178"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"to_owned",props:{style:{color:"#DCDCAA"}}},{content:"() + ",props:{style:{color:"#D4D4D4"}}},{content:"id",props:{style:{color:"#9CDCFE"}}},{content:";",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"key_map",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"HashMap",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"AttributeValue",props:{style:{color:"#4EC9B0"}}},{content:"> = [(",props:{style:{color:"#D4D4D4"}}},{content:'"id"',props:{style:{color:"#CE9178"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"to_string",props:{style:{color:"#DCDCAA"}}},{content:"(), ",props:{style:{color:"#D4D4D4"}}},{content:"AttributeValue",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"S",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"key",props:{style:{color:"#9CDCFE"}}},{content:"))]",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"iter",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"cloned",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"collect",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    match ",props:{style:{color:"#C586C0"}}},{content:"client",props:{style:{color:"#9CDCFE"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"get_item",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"table_name",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"table_name",props:{style:{color:"#9CDCFE"}}},{content:")",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"set_key",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"Some",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"key_map",props:{style:{color:"#9CDCFE"}}},{content:"))",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"send",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        .",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}}]},{tokens:[{content:"    {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        Ok",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"result",props:{style:{color:"#9CDCFE"}}},{content:") => ",props:{style:{color:"#D4D4D4"}}},{content:"match ",props:{style:{color:"#C586C0"}}},{content:"result",props:{style:{color:"#9CDCFE"}}},{content:".item {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            None",props:{style:{color:"#4EC9B0"}}},{content:" => ",props:{style:{color:"#D4D4D4"}}},{content:"Err",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"QueryError",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"NotFound",props:{style:{color:"#4EC9B0"}}},{content:"),",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            Some",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"item",props:{style:{color:"#9CDCFE"}}},{content:") => {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"                let ",props:{style:{color:"#569CD6"}}},{content:"i",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"User",props:{style:{color:"#4EC9B0"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"from_item",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"item",props:{style:{color:"#9CDCFE"}}},{content:")?;",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"                Ok",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"i",props:{style:{color:"#9CDCFE"}}},{content:")",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        },",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        Err",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"e",props:{style:{color:"#9CDCFE"}}},{content:") => ",props:{style:{color:"#D4D4D4"}}},{content:"Err",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"e",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"into",props:{style:{color:"#DCDCAA"}}},{content:"()),",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"}",props:{style:{color:"#D4D4D4"}}}]}],lang:"rust"},annotations:[]}],children:[(0,n.jsx)(t.p,{children:"Working with DynamoDB is a breeze when paired with the AWS SDK for Rust.  In this example, we are going to execute a GetItemRequest which will fetch one item or return an empty resultset if not found.  We will be looking the User up by  the Partition Key (PK)."}),(0,n.jsxs)(t.p,{children:["First thing this code is doing is building the PK value which is the string ",(0,n.jsx)(a.SectionLink,{focus:"2[16:20]",id:"focus://2[16:20]",children:(0,n.jsx)(t.code,{children:"USER#"})})," added to the immutable unique identifier which matches up with the Cognito user_id."]}),(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(a.SectionLink,{focus:"9[10:19]",id:"focus://9[10:19]",children:(0,n.jsx)(t.code,{children:"get_item"})})," function call expects an ",(0,n.jsx)(a.SectionLink,{focus:"3[18:48]",id:"focus://3[18:48]",children:(0,n.jsx)(t.code,{children:"Option<HashMap<String,AttributeValue>>"})})," and a table name which is supplied in the function call."]}),(0,n.jsx)(a.SectionCode,{}),(0,n.jsxs)(t.p,{children:["The result of querying DynamoDB will return a Result which can be checked for OK and Err in typical Rust fashion.  If the item is not found, we can return our custom ",(0,n.jsx)(a.SectionLink,{focus:"16[25:44]",id:"focus://16[25:44]",children:(0,n.jsx)(t.code,{children:"QueryError::NotFound"})}),".  However, if found, then we return the output of ",(0,n.jsx)(a.SectionLink,{focus:"18[30:39]",id:"focus://18[30:39]",children:(0,n.jsx)(t.code,{children:"serde_dynamodb::from_item"})})]}),(0,n.jsx)(t.p,{children:"With a DynamoDB record transformed into a User model, let's have a look at the Lambda handler code."})]}),"\n",(0,n.jsx)(t.h3,{id:"handler-code",children:"Handler Code"}),"\n",(0,n.jsx)(t.p,{children:"Going back to our handler code here's what it looks like."}),"\n",(0,n.jsx)(a.Scrollycoding,{codeConfig:y,editorSteps:[{northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"async fn ",props:{style:{color:"#569CD6"}}},{content:"function_handler",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    client",props:{style:{color:"#9CDCFE"}}},{content:": &",props:{style:{color:"#D4D4D4"}}},{content:"Client",props:{style:{color:"#4EC9B0"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    table_name",props:{style:{color:"#9CDCFE"}}},{content:": &",props:{style:{color:"#D4D4D4"}}},{content:"String",props:{style:{color:"#4EC9B0"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    mut ",props:{style:{color:"#569CD6"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"LambdaEvent",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"CognitoEventUserPoolsPreTokenGenV2",props:{style:{color:"#4EC9B0"}}},{content:">,",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:") -> ",props:{style:{color:"#D4D4D4"}}},{content:"Result",props:{style:{color:"#4EC9B0"}}},{content:"<",props:{style:{color:"#D4D4D4"}}},{content:"CognitoEventUserPoolsPreTokenGenV2",props:{style:{color:"#4EC9B0"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"Error",props:{style:{color:"#4EC9B0"}}},{content:"> {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let mut ",props:{style:{color:"#569CD6"}}},{content:"access",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"HashMap",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"new",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let mut ",props:{style:{color:"#569CD6"}}},{content:"id",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"HashMap",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"new",props:{style:{color:"#DCDCAA"}}},{content:"();",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    match ",props:{style:{color:"#C586C0"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:".payload.cognito_event_user_pools_header.user_name {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        Some",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"ref ",props:{style:{color:"#569CD6"}}},{content:"user_name",props:{style:{color:"#9CDCFE"}}},{content:") => {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            let ",props:{style:{color:"#569CD6"}}},{content:"user",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"data",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"fetch_item",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"client",props:{style:{color:"#9CDCFE"}}},{content:", &",props:{style:{color:"#D4D4D4"}}},{content:"table_name",props:{style:{color:"#9CDCFE"}}},{content:", ",props:{style:{color:"#D4D4D4"}}},{content:"user_name",props:{style:{color:"#9CDCFE"}}},{content:").",props:{style:{color:"#D4D4D4"}}},{content:"await",props:{style:{color:"#C586C0"}}},{content:"?;",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            access",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"insert",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"interesting_value"',props:{style:{color:"#CE9178"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"to_string",props:{style:{color:"#DCDCAA"}}},{content:"(), ",props:{style:{color:"#D4D4D4"}}},{content:"user",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"get_interesting_value",props:{style:{color:"#DCDCAA"}}},{content:"());",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            id",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"insert",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"first_name"',props:{style:{color:"#CE9178"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"to_string",props:{style:{color:"#DCDCAA"}}},{content:"(), ",props:{style:{color:"#D4D4D4"}}},{content:"user",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"get_first_name",props:{style:{color:"#DCDCAA"}}},{content:"());",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            id",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"insert",props:{style:{color:"#DCDCAA"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:'"last_name"',props:{style:{color:"#CE9178"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"to_string",props:{style:{color:"#DCDCAA"}}},{content:"(), ",props:{style:{color:"#D4D4D4"}}},{content:"user",props:{style:{color:"#9CDCFE"}}},{content:".",props:{style:{color:"#D4D4D4"}}},{content:"get_last_name",props:{style:{color:"#DCDCAA"}}},{content:"());",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        None",props:{style:{color:"#4EC9B0"}}},{content:" => {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            event",props:{style:{color:"#9CDCFE"}}}]},{tokens:[{content:"                .payload",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"                .response",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"                .claims_and_scope_override_details",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"                .",props:{style:{color:"#D4D4D4"}}},{content:"as_mut",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"                .",props:{style:{color:"#D4D4D4"}}},{content:"unwrap",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"                .group_override_details",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"                .groups_to_override = ",props:{style:{color:"#D4D4D4"}}},{content:"vec!",props:{style:{color:"#DCDCAA"}}},{content:"[];",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    }",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"access_token",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"CognitoAccessTokenGenerationV2",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        claims_to_add_or_override",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"access",props:{style:{color:"#9CDCFE"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        claims_to_suppress",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"vec!",props:{style:{color:"#DCDCAA"}}},{content:"[],",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        scopes_to_add",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"vec!",props:{style:{color:"#DCDCAA"}}},{content:"[],",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        scopes_to_suppress",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"vec!",props:{style:{color:"#DCDCAA"}}},{content:"[],",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    };",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"id_token",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"CognitoIdTokenGenerationV2",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        claims_to_add_or_override",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"id",props:{style:{color:"#9CDCFE"}}},{content:",",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        claims_to_suppress",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"vec!",props:{style:{color:"#DCDCAA"}}},{content:"[],",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    };",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    let ",props:{style:{color:"#569CD6"}}},{content:"ovr",props:{style:{color:"#9CDCFE"}}},{content:" = ",props:{style:{color:"#D4D4D4"}}},{content:"ClaimsAndScopeOverrideDetailsV2",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        access_token_generation",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"Some",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"access_token",props:{style:{color:"#9CDCFE"}}},{content:"),",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        group_override_details",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"GroupConfiguration",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"            ..",props:{style:{color:"#D4D4D4"}}},{content:"Default",props:{style:{color:"#4EC9B0"}}},{content:"::",props:{style:{color:"#D4D4D4"}}},{content:"default",props:{style:{color:"#DCDCAA"}}},{content:"()",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        },",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        id_token_generation",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"Some",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"id_token",props:{style:{color:"#9CDCFE"}}},{content:"),",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    };",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    event",props:{style:{color:"#9CDCFE"}}},{content:".payload.response = ",props:{style:{color:"#D4D4D4"}}},{content:"CognitoEventUserPoolsPreTokenGenResponseV2",props:{style:{color:"#4EC9B0"}}},{content:" {",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"        claims_and_scope_override_details",props:{style:{color:"#9CDCFE"}}},{content:": ",props:{style:{color:"#D4D4D4"}}},{content:"Some",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"ovr",props:{style:{color:"#9CDCFE"}}},{content:"),",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    };",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"    Ok",props:{style:{color:"#4EC9B0"}}},{content:"(",props:{style:{color:"#D4D4D4"}}},{content:"event",props:{style:{color:"#9CDCFE"}}},{content:".payload)",props:{style:{color:"#D4D4D4"}}}]},{tokens:[{content:"}",props:{style:{color:"#D4D4D4"}}}]}],lang:"rust"},annotations:[]}]}],children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(a.SectionLink,{focus:"4[16:26]",id:"focus://4[16:26]",children:(0,n.jsx)(t.code,{children:"Lambda"})})," struct is a templated implementation that takes a CognitoEventUserPoolsPreTokenGenV2.  This event struct has some convienence fieds on it that are useful for grabbing the user_name."]}),(0,n.jsxs)(t.p,{children:["With the user_name, we can now execute the ",(0,n.jsx)(a.SectionLink,{focus:"10[22:40]",id:"focus://10[22:40]",children:(0,n.jsx)(t.code,{children:"data::fetch_item"})}),".  With a fetched User model, I can now start adding to the HashMaps.  Remember, we are customizing both the ID and the Access token here so we want 2 HashMaps; one for each."]}),(0,n.jsxs)(t.p,{children:["With the ID and Access token HashMaps created, we can construct the structs that get returned back as a part of the CognitoEventUserPoolsPreTokenGenV2 Result.  The struct that is returned has a few other nested fields that need to be accounted for but before, but the following statement sets up the payload with the HashMap. ",(0,n.jsx)(a.SectionLink,{focus:"39[5:48]",id:"focus://39[5:48]",children:(0,n.jsx)(t.code,{children:"let ovr = ClaimsAndScopeOverrideDetailsV2"})}),"."]}),(0,n.jsx)(t.p,{children:"And that's it, the payload can be returned to Cognito."}),(0,n.jsx)(a.CodeSlot,{})]})}),"\n",(0,n.jsx)(t.h2,{id:"displaying-the-output",children:"Displaying the Output"}),"\n",(0,n.jsx)(t.p,{children:"With a successfully customized Access and ID token, they should look like the below implementations."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Access Token"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:e(1099).A+"",loading:"lazy",alt:"Customized Access Token",width:"2280",height:"1144"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"ID Token"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:e(4985).A+"",loading:"lazy",alt:"Customized ID Token",width:"2280",height:"1080"})}),"\n",(0,n.jsx)(t.h2,{id:"congratulations",children:"Congratulations"}),"\n",(0,n.jsx)(t.p,{children:"Congratulations, you now have a Rust Lambda Function that handles the Cognito Token Customization hook which allows overriding claims in the ID and Access Token!"})]})}const C=function(o={}){const{wrapper:t}=Object.assign({},(0,s.R)(),o.components);return t?(0,n.jsx)(t,Object.assign({},o,{children:(0,n.jsx)(d,o)})):d(o)};function h(o,t){throw new Error("Expected "+(t?"component":"object")+" `"+o+"` to be defined: you likely forgot to import, pass, or provide it.")}},1099:(o,t,e)=>{e.d(t,{A:()=>n});const n=e.p+"assets/images/acces_token_customized-ae9214fba486c81d4ed7efef3ed26dbc.png"},4985:(o,t,e)=>{e.d(t,{A:()=>n});const n=e.p+"assets/images/id_token_customized-734d415e8cd9fbab518d95999f1cb0cc.png"}}]);